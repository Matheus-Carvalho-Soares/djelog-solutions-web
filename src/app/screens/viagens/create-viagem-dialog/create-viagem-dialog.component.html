<div class="dialog-shell">
  <div class="dialog-scan-line"></div>

  <!-- Header -->
  <div class="dialog-header">
    <div class="header-title-group">
      <div class="header-accent"></div>
      <div>
        <h2 class="dialog-title">{{ dialogTitle }}</h2>
        <p class="dialog-subtitle">{{ dialogSubtitle }}</p>
      </div>
    </div>
    <button class="close-btn" (click)="cancel()">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <!-- Loading overlay -->
  <div class="loading-overlay" *ngIf="isLoadingData">
    <mat-spinner diameter="32" class="data-spinner"></mat-spinner>
    <span class="loading-label">Carregando dados...</span>
  </div>

  <!-- Form -->
  <div class="dialog-body" *ngIf="!isLoadingData">
    <!-- Section: Associações -->
    <div class="form-section">
      <div class="section-label">
        <mat-icon>link</mat-icon>
        ASSOCIAÇÕES
      </div>

      <div class="form-row">
        <div class="form-group flex-1">
          <label class="field-label">
            <mat-icon class="label-icon">local_shipping</mat-icon>
            VEÍCULO *
          </label>
          <div class="select-wrapper">
            <select
              class="neon-select"
              [(ngModel)]="selectedVeiculoId"
              (ngModelChange)="onVeiculoChange()"
            >
              <option [ngValue]="null">— Selecionar veículo —</option>
              <option *ngFor="let v of veiculos" [ngValue]="v.id">
                {{ v.marca }} {{ v.ano ? '(' + v.ano + ')' : '' }}
              </option>
            </select>
            <mat-icon class="select-arrow">expand_more</mat-icon>
          </div>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group flex-1">
          <label class="field-label">
            <mat-icon class="label-icon">person</mat-icon>
            MOTORISTA *
          </label>
          <div class="select-wrapper">
            <select
              class="neon-select"
              [(ngModel)]="selectedProfissionalId"
            >
              <option [ngValue]="null">— Selecionar motorista —</option>
              <option *ngFor="let p of profissionais" [ngValue]="p.id">
                {{ p.nome }}
              </option>
            </select>
            <mat-icon class="select-arrow">expand_more</mat-icon>
          </div>
          <span class="field-hint" *ngIf="selectedVeiculoId">
            <mat-icon class="hint-icon">info</mat-icon>
            Preenchido automaticamente pelo veículo selecionado
          </span>
        </div>

        <div class="form-group flex-1">
          <label class="field-label">
            <mat-icon class="label-icon">business</mat-icon>
            EMPRESA *
          </label>
          <div class="select-wrapper">
            <select
              class="neon-select"
              [(ngModel)]="selectedEmpresaId"
            >
              <option [ngValue]="null">— Selecionar empresa —</option>
              <option *ngFor="let e of empresas" [ngValue]="e.id">
                {{ e.nome }}
              </option>
            </select>
            <mat-icon class="select-arrow">expand_more</mat-icon>
          </div>
        </div>
      </div>
    </div>

    <!-- Section: Frete -->
    <div class="form-section">
      <div class="section-label">
        <mat-icon>local_shipping</mat-icon>
        DADOS DO FRETE
      </div>

      <div class="form-group">
        <label class="field-label">
          <mat-icon class="label-icon">location_on</mat-icon>
          LOCALIZAÇÃO DO FRETE *
        </label>
        <div class="input-wrapper">
          <input
            type="text"
            class="neon-input"
            [(ngModel)]="localizacaoFrete"
            placeholder="Ex: São Paulo → Rio de Janeiro"
            autocomplete="off"
          />
          <div class="input-border"></div>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group flex-1">
          <label class="field-label">
            <mat-icon class="label-icon">attach_money</mat-icon>
            VALOR DO FRETE *
          </label>
          <div class="input-wrapper">
            <input
              type="number"
              class="neon-input"
              [(ngModel)]="valorFrete"
              placeholder="0,00"
              step="0.01"
              min="0"
              autocomplete="off"
            />
            <div class="input-border"></div>
          </div>
        </div>

        <div class="form-group flex-1">
          <label class="field-label">
            <mat-icon class="label-icon">percent</mat-icon>
            COMISSÃO
          </label>
          <div class="input-wrapper">
            <input
              type="number"
              class="neon-input"
              [(ngModel)]="comissao"
              placeholder="0,00"
              step="0.01"
              min="0"
              autocomplete="off"
            />
            <div class="input-border"></div>
          </div>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group flex-1">
          <label class="field-label">
            <mat-icon class="label-icon">local_gas_station</mat-icon>
            ABASTECIMENTO
          </label>
          <div class="input-wrapper">
            <input
              type="number"
              class="neon-input"
              [(ngModel)]="abastecimento"
              placeholder="0,00"
              step="0.01"
              min="0"
              autocomplete="off"
            />
            <div class="input-border"></div>
          </div>
        </div>

        <div class="form-group flex-1">
          <label class="field-label">
            <mat-icon class="label-icon">money_off</mat-icon>
            DESPESAS
          </label>
          <div class="input-wrapper">
            <input
              type="number"
              class="neon-input"
              [(ngModel)]="despesas"
              placeholder="0,00"
              step="0.01"
              min="0"
              autocomplete="off"
            />
            <div class="input-border"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Section: Datas e Status -->
    <div class="form-section">
      <div class="section-label">
        <mat-icon>schedule</mat-icon>
        PERÍODO E STATUS
      </div>

      <div class="form-row">
        <div class="form-group flex-1">
          <label class="field-label">
            <mat-icon class="label-icon">event</mat-icon>
            DATA INÍCIO *
          </label>
          <div class="input-wrapper">
            <input
              type="date"
              class="neon-input"
              [(ngModel)]="dataInicio"
            />
            <div class="input-border"></div>
          </div>
        </div>

        <div class="form-group flex-1">
          <label class="field-label">
            <mat-icon class="label-icon">event_available</mat-icon>
            DATA FIM
          </label>
          <div class="input-wrapper">
            <input
              type="date"
              class="neon-input"
              [(ngModel)]="dataFim"
            />
            <div class="input-border"></div>
          </div>
        </div>
      </div>

      <div class="form-group">
        <label class="field-label">
          <mat-icon class="label-icon">flag</mat-icon>
          STATUS *
        </label>
        <div class="select-wrapper">
          <select class="neon-select" [(ngModel)]="status">
            <option value="EM_ANDAMENTO">Em Andamento</option>
            <option value="CONCLUIDA">Concluída</option>
            <option value="CANCELADA">Cancelada</option>
          </select>
          <mat-icon class="select-arrow">expand_more</mat-icon>
        </div>
      </div>
    </div>

    <!-- Error message -->
    <div class="error-banner" *ngIf="errorMessage">
      <mat-icon class="error-banner-icon">error_outline</mat-icon>
      <span>{{ errorMessage }}</span>
    </div>
  </div>

  <!-- Footer -->
  <div class="dialog-footer">
    <button class="cancel-btn" (click)="cancel()" [disabled]="isSaving">
      <span>CANCELAR</span>
    </button>
    <button
      class="save-btn"
      (click)="save()"
      [disabled]="!isFormValid || isSaving"
      [class.saving]="isSaving"
    >
      <mat-spinner *ngIf="isSaving" diameter="18" class="save-spinner"></mat-spinner>
      <mat-icon *ngIf="!isSaving">check</mat-icon>
      <span>{{ isSaving ? 'SALVANDO...' : actionLabel }}</span>
    </button>
  </div>

  <div class="dialog-corner"></div>
</div>
