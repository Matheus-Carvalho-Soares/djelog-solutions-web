<div class="dashboard-content">

  <!-- Loading State -->
  <div class="dashboard-loading" *ngIf="isLoading">
    <mat-spinner diameter="40"></mat-spinner>
    <p class="loading-text">Carregando dashboard...</p>
  </div>

  <!-- Error State (real connection error) -->
  <div class="dashboard-error" *ngIf="hasError && !isLoading">
    <mat-icon class="error-icon">warning_amber</mat-icon>
    <p class="error-title">Falha ao carregar dados</p>
    <p class="error-subtitle">Verifique a conexão com o servidor</p>
    <button class="retry-btn" (click)="loadDashboard()">
      <mat-icon>refresh</mat-icon>
      <span>Tentar Novamente</span>
    </button>
  </div>

  <!-- Empty State (no trips) -->
  <div class="dashboard-empty" *ngIf="isEmpty && !isLoading && !hasError">
    <mat-icon class="empty-icon">route</mat-icon>
    <p class="empty-title">Nenhuma viagem cadastrada</p>
    <p class="empty-subtitle">Cadastre sua primeira viagem para visualizar o dashboard com dados financeiros, gráficos e métricas.</p>
  </div>

  <!-- Dashboard Content -->
  <ng-container *ngIf="!isLoading && !hasError && !isEmpty">
    <!-- Filters Section -->
    <div class="filters-section">
      <div class="filters-header">
        <mat-icon class="filters-icon">filter_list</mat-icon>
        <span class="filters-label">FILTROS</span>
      </div>
      <div class="filters-fields">
        <mat-form-field appearance="outline" class="filter-field">
          <mat-label>Veículo</mat-label>
          <mat-select [(ngModel)]="selectedVeiculoId" (selectionChange)="applyFilters()">
            <mat-option value="">Todos</mat-option>
            <mat-option *ngFor="let v of veiculoOptions" [value]="v.id">
              {{ v.placa ? v.placa + ' — ' + v.marca : v.marca }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline" class="filter-field">
          <mat-label>Profissional</mat-label>
          <mat-select [(ngModel)]="selectedProfissionalId" (selectionChange)="applyFilters()">
            <mat-option value="">Todos</mat-option>
            <mat-option *ngFor="let p of profissionalOptions" [value]="p.id">
              {{ p.nome }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <button class="clear-filters-btn" *ngIf="hasActiveFilters" (click)="clearFilters()">
          <mat-icon>clear</mat-icon>
          <span>Limpar</span>
        </button>
      </div>
    </div>

    <!-- Comissões Toggle -->
    <div class="comissoes-toggle" *ngIf="comissaoComissionada && comissaoComissionada.quantidadeViagens > 0">
      <mat-checkbox
        [(ngModel)]="includeComissoes"
        class="comissoes-checkbox"
        color="warn"
      >
        <span class="comissoes-toggle-label">
          <mat-icon class="comissoes-toggle-icon">payments</mat-icon>
          Exibir comissões de viagens comissionadas
        </span>
      </mat-checkbox>
    </div>

    <app-financial-cards
      *ngIf="financialSummary"
      [summary]="financialSummary"
      [comissaoComissionada]="includeComissoes ? comissaoComissionada : null"
    ></app-financial-cards>

    <app-performance-chart
      *ngIf="monthlyPerformance && weeklyPerformance"
      [performance]="monthlyPerformance"
      [weeklyPerformance]="weeklyPerformance"
    ></app-performance-chart>

    <div class="panel-grid">
      <app-vehicle-table [vehicles]="vehiclePerformance"></app-vehicle-table>
      <app-recent-trips [trips]="recentTrips"></app-recent-trips>
    </div>
  </ng-container>
</div>
